<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springGroupS10.dao.MemberDAO">

	<!-- DB 컬럼명이 camelCase(userId)로 변경되어 수정 -->
	<select id="getMemberByUserId" resultType="com.spring.springGroupS10.vo.MemberVO">
		select * from member where userId = #{userId}
	</select>
	
	<!-- DB 컬럼명이 camelCase(nickName)로 변경되어 수정 -->
	<select id="getMemberByNickName" resultType="com.spring.springGroupS10.vo.MemberVO">
		select * from member where nickName = #{nickName}
	</select>
	
	<select id="getTotRecCnt" resultType="int">
	  select count(*) from member
	  <if test="level != 99">
	    where level = #{level}
	  </if>
	</select>
	
	<!-- DB 컬럼명이 camelCase(deletedAt)로 변경되어 수정 -->
	<select id="getMemberList" resultType="com.spring.springGroupS10.vo.MemberVO">
	  select *, timestampdiff(day, deletedAt, now()) as deleteDiff from member
	  <if test="level != 99">
	    where level = #{level}
	  </if>
	  order by idx desc 
	  limit #{startIndexNo}, #{pageSize}
	</select>
	
	<select id="findUserIdByEmail" resultType="string" parameterType="string">
		select userId from member where email = #{email}
	</select>
	
	<select id="getProductSearch" resultType="com.spring.springGroupS10.vo.MemberVO">
		select * from member where nickName = #{nickName}
	</select>
	
	
	
	
	
	
	<!-- DB 컬럼명이 camelCase로 변경되어 수정 -->
	<insert id="setMemberJoin">
		insert into member (userId, password, nickName, name, email, tel, birthday, gender, postCode, address1, address2) 
		values (#{vo.userId}, #{vo.password}, #{vo.nickName}, #{vo.name}, #{vo.email}, #{vo.tel}, #{vo.birthday}, #{vo.gender}, #{vo.postCode}, #{vo.address1}, #{vo.address2})
	</insert>
	
	<update id="setMemberLevelUp">
		update member set level = 2 where userId = #{userId}
	</update>
	
	<!-- DB 컬럼명이 camelCase(todayCnt, userId)로 변경되어 수정 -->
	<update id="setMemberTodayCntClear">
		update member set todayCnt = 0 where userId = #{userId}
	</update>
	
	<!-- DB 컬럼명이 camelCase로 변경되어 수정 -->
	<update id="setMemberInforUpdate">
		update member set visitCnt=visitCnt+1, lastLoginAt=now(), todayCnt=todayCnt+1, point=point+#{point} where userId = #{userId}
	</update>
	
  <update id="updateMemberLevel">
    update member set level = #{level} where idx = #{idx}
  </update>
  
  <update id="updatePasswordByUserId">
  	update member set password = #{encodedPassword} where userId = #{userId}
  </update>	
	
	
	
	
	
  <!-- DB 컬럼명이 camelCase(isDeleted, deletedAt)로 변경되어 수정 -->
  <delete id="deleteExpiredMembers">
    delete from member where isDeleted = true and timestampdiff(day, deletedAt, now()) >= 30
  </delete>
	
</mapper>

