<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springGroupS10.dao.PdsDAO">
	
	<select id="getTotRecCnt" resultType="int">
		select ifnull(count(*), 0) from pds <if test='part != null and part != ""'> where part = #{part} </if>
	</select>
	
	<select id="getPdsList" resultType="com.spring.springGroupS10.vo.PdsVO">
		select p.*, m.nickName from pds p join member m on p.memberIdx = m.idx
		<if test='part != null and part != ""'> where p.part = #{part} </if>
		order by p.idx desc
		limit #{startIndexNo}, #{pageSize};
	</select>
	
	<select id="getPdsContent" resultType="com.spring.springGroupS10.vo.PdsVO">
		select p.*, m.nickName from pds p join member m on p.memberIdx = m.idx where p.idx = #{idx};
	</select>
	
	<select id="getPdsIdx" resultType="com.spring.springGroupS10.vo.PdsVO">
		select * from pds where idx = #{idx};
	</select>
	
	
	<insert id="pdsUpload" parameterType="com.spring.springGroupS10.vo.PdsVO">
	    insert into pds (
	        memberIdx, fName, fSName, fSize, part, title, content, openSw, hostIp, createdAt, downNum) 
	        values (
	        #{vo.memberIdx}, #{vo.fName}, #{vo.fSName}, #{vo.fSize}, #{vo.part}, #{vo.title}, #{vo.content}, #{vo.openSw}, 
	        #{vo.hostIp}, now(), 0 );
	</insert>
	
	
	<update id="setPdsDownNumCheck">
		update pds set downNum = downNum + 1 where idx = #{idx};
	</update>
	
	<update id="pdsUpdate">
		update pds set
			fName    = #{vo.FName},
			fSName   = #{vo.FSName},
			fSize    = #{vo.FSize},
			title    = #{vo.title},
			part     = #{vo.part},
			content  = #{vo.content},
			openSw   = #{vo.openSw}
		where idx = #{vo.idx}
	</update>
	
	
	<delete id="getPdsDelelte">
		delete from pds where idx = #{idx};
	</delete>

</mapper>