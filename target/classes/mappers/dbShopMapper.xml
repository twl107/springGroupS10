<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.springGroupS10.dao.DbShopDAO">

	<select id="getCategoryMain" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from categoryMain order by categoryMainCode desc;
	</select>

	<select id="getCategoryMiddle" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select middle.*, main.categoryMainName from categoryMiddle middle, categoryMain main
	    where middle.categoryMainCode=main.categoryMainCode
	    order by categoryMiddleCode desc;
	</select>
	
	<select id="getCategoryMainOne" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from categoryMain where categoryMainCode=#{categoryMainCode} and categoryMainName=#{categoryMainName};
	</select>

	<select id="getCategoryMiddleOne" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from categoryMiddle 
			where categoryMainCode=#{vo.categoryMainCode} and categoryMiddleCode=#{vo.categoryMiddleCode} and categoryMiddleName=#{vo.categoryMiddleName};
	</select>
	
	<select id="getCategoryProductName" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from dbProduct where categoryMainCode=#{vo.categoryMainCode} and categoryMiddleCode=#{vo.categoryMiddleCode}; 
	</select>
	
	<select id="getCategoryMiddleName" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from categoryMiddle where categoryMainCode=#{categoryMainCode};
	</select>
	
	<select id="getProductMaxIdx" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from dbProduct order by idx desc limit 1;
	</select>
	
	<select id="getMiddleCategory" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from categoryMiddle where categoryMainCode=#{mainCategory};
	</select>
	
	<select id="getAllMainCategory" resultType="com.spring.springGroupS10.vo.DbProductVO">
	  select * from categoryMain order by categoryMainCode;
	</select>
		
	<select id="getAllMiddleCategory" resultType="com.spring.springGroupS10.vo.DbProductVO">
	  select 
	    MIN(categoryMiddleCode) as categoryMiddleCode, 
	    categoryMiddleName 
	  from 
	    categoryMiddle 
	  group by 
	    categoryMiddleName 
	  order by 
	    categoryMiddleCode;
	</select>
	
	<select id="getDbShopList" parameterType="map" resultType="com.spring.springGroupS10.vo.DbProductVO">
	  SELECT * FROM dbProduct
	  <where>
	    <if test="mainCategories != null and mainCategories.size() > 0">
	      categoryMainCode IN
	      <foreach item="mainCode" collection="mainCategories" open="(" separator="," close=")">
	        #{mainCode}
	      </foreach>
	    </if>
	    
	    <if test="middleCategories != null and middleCategories.size() > 0">
	      <if test="mainCategories != null and mainCategories.size() > 0">
	        OR
	      </if>
	      categoryMiddleCode IN
	      <foreach item="middleCode" collection="middleCategories" open="(" separator="," close=")">
	        #{middleCode}
	      </foreach>
	    </if>
	  </where>
	  ORDER BY idx DESC
	</select>
	
	<select id="getDbShopProduct" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from dbProduct where idx = #{idx};
	</select>
	
  <select id="getDbShopOption" resultType="com.spring.springGroupS10.vo.DbOptionVO">
  	select * from dbOption where productIdx = #{idx} order by idx;
  </select>
	
	<select id="getCategoryProductNameOne" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from dbProduct where productName = #{productName}; 
	</select>
	
	<select id="getCategoryProductNameOneVO" resultType="com.spring.springGroupS10.vo.DbProductVO">
    select *,
      (select categoryMainName from categoryMain where categoryMainCode=#{vo.categoryMainCode}) as categoryMainName,
      (select categoryMiddleName from categoryMiddle where categoryMiddleCode=#{vo.categoryMiddleCode}) as categoryMiddleName
      from dbProduct where productName = #{vo.productName};
	</select>
	
	<select id="getCategoryProductNameAjax" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from dbProduct where categoryMainCode = #{categoryMainCode} and categoryMiddleCode = #{categoryMiddleCode};
	</select>
	
	<select id="getProductInfor" resultType="com.spring.springGroupS10.vo.DbProductVO">
  	select product.*,
	    (select categoryMainName from categoryMain where categoryMainCode=product.categoryMainCode) as categoryMainName,
	    (select categoryMiddleName from categoryMiddle where categoryMiddleCode=product.categoryMiddleCode) as categoryMiddleName
	  	from dbProduct product, categoryMain main, categoryMiddle middle
	  	where productName=#{productName} order by idx limit 1;
	</select>
	
	<select id="getOptionList" resultType="com.spring.springGroupS10.vo.DbOptionVO">
		select * from dbOption where productIdx = #{productIdx} order by optionName;
	</select>
	
  <select id="getOptionSame" resultType="int">
    select count(*) from dbOption where productIdx=#{productIdx} and optionName=#{optionName};
  </select>
	
	<select id="getProductByMainCategory" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from dbProduct where categoryMainCode = #{mainCategoryCode} order by idx desc;
	</select>
	
	<select id="getDbProductList" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from dbProduct order by idx desc;
	</select>
	
	<select id="getProductSearch" resultType="com.spring.springGroupS10.vo.DbProductVO">
		select * from dbProduct where productName like concat('%', #{keyword}, '%') order by idx desc;
	</select>
	
	<select id="getDbShopOptionOne" resultType="com.spring.springGroupS10.vo.DbProductVO" parameterType="int">
		select * from dbOption where idx = #{optionIdx};
	</select>
	
	
	
	
	
	
	<insert id="setCategoryMainInput">
		insert into categoryMain values (#{vo.categoryMainCode},#{vo.categoryMainName});
	</insert>
	
	<insert id="setCategoryMiddleInput">
		insert into categoryMiddle values (#{vo.categoryMainCode},#{vo.categoryMiddleCode},#{vo.categoryMiddleName});
	</insert>

	<insert id="setDbProductInput">
    insert into dbProduct value (#{vo.idx},#{vo.categoryMainCode},#{vo.categoryMiddleCode},#{vo.productCode},#{vo.productName},#{vo.detail},#{vo.mainPrice},#{vo.fSName},#{vo.content});
  </insert>
	
  <insert id="setDbOptionInput">
    insert into dbOption values (default,#{vo.productIdx},#{vo.optionName},#{vo.optionPrice});
  </insert>	
	
	
	
	
	
	
	<delete id="setCategoryMainDelete">
		delete from categoryMain where categoryMainCode=#{categoryMainCode};
	</delete>
	
	<delete id="setCategoryMiddleDelete">
		delete from categoryMiddle where categoryMiddleCode=#{categoryMiddleCode};
	</delete>
	
	<delete id="setOptionDelete">
		delete from dbOption where idx = #{idx};
	</delete>
	
	
	
	

</mapper>